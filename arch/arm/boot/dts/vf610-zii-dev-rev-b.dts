/*
 * Copyright 2013 Freescale Semiconductor, Inc.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 */

/dts-v1/;
#include "vf610-zii-dev.dtsi"

/ {
	model = "ZII VF610 Development Board, Rev B";
	compatible = "zii,vf610dev-b", "zii,vf610dev", "fsl,vf610";

	chosen {
		bootargs = "console=ttyLP0,115200n8";
		stdout-path = &uart0;
	};

	memory {
		reg = <0x80000000 0x8000000>;
	};

	gpio-leds {
		compatible = "gpio-leds";
		pinctrl-0 = <&pinctrl_leds_debug>;
		pinctrl-names = "default";

		debug_1 {
			label = "zii:green:debug1";
			gpios = <&gpio2 10 GPIO_ACTIVE_HIGH>;
		};
	};

	mdio-mux {
		compatible = "mdio-mux-gpio";
		pinctrl-0 = <&pinctrl_mdio_mux>;
		pinctrl-names = "default";
		gpios = <&gpio0 8  GPIO_ACTIVE_HIGH
			 &gpio0 9  GPIO_ACTIVE_HIGH
			 &gpio0 24 GPIO_ACTIVE_HIGH
			 &gpio0 25 GPIO_ACTIVE_HIGH>;
		mdio-parent-bus = <&mdio1>;
		#address-cells = <1>;
		#size-cells = <0>;

		mdio_mux_1: mdio@1 {
			reg = <1>;
			#address-cells = <1>;
			#size-cells = <0>;
		};

		mdio_mux_2: mdio@2 {
			reg = <2>;
			#address-cells = <1>;
			#size-cells = <0>;
		};

		mdio_mux_4: mdio@4 {
			reg = <4>;
			#address-cells = <1>;
			#size-cells = <0>;
		};

		mdio_mux_8: mdio@8 {
			reg = <8>;
			#address-cells = <1>;
			#size-cells = <0>;
		};
	};

	dsa@0 {
		compatible = "marvell,dsa";
		#address-cells = <2>;
		#size-cells = <0>;

		dsa,ethernet = <&fec1>;

		/* 6352 - Primary - 7 ports */
		switch0: switch@2 {
			#address-cells = <1>;
			#size-cells = <0>;
			reg = <0 0>;
			switch = <&switchdev0>;
			eeprom-length = <512>;

			port@0 {
				reg = <0>;
				label = "lan0";
			};

			port@1 {
				reg = <1>;
				label = "lan1";
			};

			port@2 {
				reg = <2>;
				label = "lan2";
			};

			switch0port5: port@5 {
				reg = <5>;
				label = "dsa";
				phy-mode = "rgmii-txid";
				link = <&switch1port6
					&switch2port9>;
				fixed-link {
					speed = <1000>;
					full-duplex;
				};
			};

			port@6 {
				reg = <6>;
				label = "cpu";
				fixed-link {
					speed = <100>;
					full-duplex;
				};
			};
		};

		/* 6352 - Secondary - 7 ports */
		switch1: switch@0 {
			#address-cells = <1>;
			#size-cells = <0>;
			switch = <&switchdev1>;
			reg = <0 1>;
			eeprom-length = <512>;

			port@0 {
				reg = <0>;
				label = "lan3";
			};

			port@1 {
				reg = <1>;
				label = "lan4";
			};

			port@2 {
				reg = <2>;
				label = "lan5";
			};

			switch1port5: port@5 {
				reg = <5>;
				label = "dsa";
				link = <&switch2port9>;
				phy-mode = "rgmii-txid";
				fixed-link {
					speed = <1000>;
					full-duplex;
				};
			};

			switch1port6: port@6 {
				reg = <6>;
				label = "dsa";
				phy-mode = "rgmii-txid";
				link = <&switch0port5>;
				fixed-link {
					speed = <1000>;
					full-duplex;
				};
			};
		};

		/* 6185 - 10 ports */
		switch2: switch@6 {
			#address-cells = <1>;
			#size-cells = <0>;
			switch = <&switchdev2>;
			reg = <0 2>;

			port@0 {
				reg = <0>;
				label = "lan6";
			};

			port@1 {
				reg = <1>;
				label = "lan7";
			};

			port@2 {
				reg = <2>;
				label = "lan8";
			};

			port@3 {
				reg = <3>;
				label = "optical3";
				fixed-link {
					speed = <1000>;
					full-duplex;
					link-gpios = <&gpio6 2 GPIO_ACTIVE_HIGH>;
				};
			};

			port@4 {
				reg = <4>;
				label = "optical4";
				fixed-link {
					speed = <1000>;
					full-duplex;
					link-gpios = <&gpio6 3 GPIO_ACTIVE_HIGH>;

				};
			};

			switch2port9: port@9 {
				reg = <9>;
				label = "dsa";
				phy-mode = "rgmii-txid";
				link = <&switch1port5
					&switch0port5>;
				fixed-link {
					speed = <1000>;
					full-duplex;
				};
			};
		};
	};

	/* Primary switch */
	switchdev0: switchdev0 {
		compatible = "marvell,mv88e6352";
		mii-bus = <&mdio_mux_1>;
		addr = <0>;
	};

	/* Secondary switch */
	switchdev1: switchdev1 {
		compatible = "marvell,mv88e6352";
		mii-bus = <&mdio_mux_2>;
		addr = <0>;
	};

	/* 6185 10-port switch */
	switchdev2: switchdev2 {
		compatible = "marvell,mv88e6131";
		mii-bus = <&mdio_mux_4>;
		addr = <0>;
	};
};

&iomuxc {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_i2c_mux_reset>;

	vf610-zii {
		pinctrl_mdio_mux: pinctrl-mdio-mux {
			fsl,pins = <
				VF610_PAD_PTA18__GPIO_8	0x31c2
				VF610_PAD_PTA19__GPIO_9	0x31c2
				VF610_PAD_PTB2__GPIO_24	0x31c2
				VF610_PAD_PTB3__GPIO_25	0x31c2
			>;
		};
		pinctrl_fec0: fec0grp {
			fsl,pins = <
				VF610_PAD_PTC0__ENET_RMII0_MDC	0x30d2
				VF610_PAD_PTC1__ENET_RMII0_MDIO	0x30d3
				VF610_PAD_PTC2__ENET_RMII0_CRS	0x30d1
				VF610_PAD_PTC3__ENET_RMII0_RXD1	0x30d1
				VF610_PAD_PTC4__ENET_RMII0_RXD0	0x30d1
				VF610_PAD_PTC5__ENET_RMII0_RXER	0x30d1
				VF610_PAD_PTC6__ENET_RMII0_TXD1	0x30d2
				VF610_PAD_PTC7__ENET_RMII0_TXD0	0x30d2
				VF610_PAD_PTC8__ENET_RMII0_TXEN	0x30d2
			>;
		};

		pinctrl_leds_debug: pinctrl-leds-debug {
			fsl,pins = <
				 VF610_PAD_PTD20__GPIO_74	0x31c2
				 >;
		};
		pinctrl_pca9554_opt: pinctrl-pca95540-opt {
			fsl,pins = <
				VF610_PAD_PTB18__GPIO_40	0x219d
			>;
		};
	};
};

&fec0 {
	phy-mode = "rmii";
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_fec0>;
	status = "okay";
};

&i2c0 {
	gpio6: pca9505@20 {
		compatible = "nxp,pca9554";
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_pca9554_opt>;
		reg = <0x22>;
		interrupt-parent = <&gpio1>;
		interrupts = <8 IRQ_TYPE_LEVEL_LOW>;
	};
};
